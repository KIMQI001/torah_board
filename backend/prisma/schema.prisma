// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id              String   @id @default(cuid())
  walletAddress   String   @unique
  publicKey       String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  lastLogin       DateTime?
  settings        String?  // JSON string for user preferences and settings
  
  // Relations
  nodes           UserNode[]
  roiCalculations ROICalculation[]
  daoMemberships  DAOMember[]
  priceAlerts     PriceAlert[]
  favoriteSymbols FavoriteSymbol[]
  newsPreference  UserNewsPreference?
  journalEntries  JournalEntry[]
  journalFolders  JournalFolder[]
  
  @@map("users")
}

model DePINProject {
  id                 String   @id @default(cuid())
  name               String   @unique
  category           String   // 'STORAGE', 'COMPUTING', 'WIRELESS', 'SENSORS'
  description        String
  blockchain         String
  tokenSymbol        String
  tokenPrice         Float    @default(0)
  marketCap          String   @default("$0")
  volume24h          String   @default("$0")
  apy                String
  status             String   @default("ACTIVE") // 'ACTIVE', 'INACTIVE', 'MAINTENANCE'
  minInvestment      Float
  roiPeriod          Int      // in months
  geographicFocus    String   // JSON string array of countries/regions
  riskLevel          String   // 'LOW', 'MEDIUM', 'HIGH'
  hardwareRequirements String // JSON string array of hardware specs
  websiteUrl         String?  // Official website URL
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  
  // Relations
  nodes              UserNode[]
  roiCalculations    ROICalculation[]
  
  @@map("depin_projects")
}

model UserNode {
  id            String   @id @default(cuid())
  userId        String
  projectId     String
  nodeId        String   // User-defined node ID
  type          String
  capacity      String?
  location      String?
  monitorUrl    String?
  status        String   @default("SYNCING") // 'ONLINE', 'OFFLINE', 'SYNCING', 'ERROR'
  uptime        String   @default("0%")
  earnings      String   @default("$0/day")
  totalEarned   Float    @default(0)
  startDate     DateTime @default(now())
  hardware      String?  // JSON string of hardware specifications
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // Relations
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  project       DePINProject @relation(fields: [projectId], references: [id])
  performances  NodePerformance[]
  
  @@unique([userId, nodeId]) // Unique node ID per user
  @@map("user_nodes")
}

model NodePerformance {
  id             String   @id @default(cuid())
  nodeId         String
  cpuUsage       Float
  memoryUsage    Float
  diskUsage      Float
  networkLatency Float
  bandwidthUp    Float
  bandwidthDown  Float
  timestamp      DateTime @default(now())
  
  // Relations
  node           UserNode @relation(fields: [nodeId], references: [id], onDelete: Cascade)
  
  @@map("node_performances")
}

model ROICalculation {
  id                    String   @id @default(cuid())
  userId                String
  projectId             String
  location              String
  hardwareCost          Float
  monthlyCost           Float
  estimatedMonthlyReward Float
  roiMonths             Float
  annualROI             Float
  riskFactors           String   // JSON string array
  createdAt             DateTime @default(now())
  
  // Relations
  user                  User     @relation(fields: [userId], references: [id])
  project               DePINProject @relation(fields: [projectId], references: [id])
  
  @@map("roi_calculations")
}

model SystemNotification {
  id          String   @id @default(cuid())
  userId      String?  // null for system-wide notifications
  type        String   // 'NODE_STATUS', 'EARNINGS_UPDATE', 'SYSTEM_ALERT', 'CAPACITY_UPDATE'
  title       String
  message     String
  isRead      Boolean  @default(false)
  data        String?  // JSON string for additional notification data
  createdAt   DateTime @default(now())
  
  @@map("system_notifications")
}

// DAO Models
model DAO {
  id              String   @id @default(cuid())
  name            String   @unique
  description     String
  treasuryAddress String
  governanceToken String
  totalSupply     Float    @default(0)
  quorumThreshold Float    @default(50) // percentage
  votingPeriod    Int      @default(7) // days
  status          String   @default("ACTIVE") // 'ACTIVE', 'PAUSED', 'DISSOLVED'
  createdBy       String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  proposals       DAOProposal[]
  projects        DAOProject[]
  members         DAOMember[]
  treasury        DAOTreasury[]
  distributions   DAODistribution[]
  fundingRequests DAOFundingRequest[]
  milestoneVerifications DAOMilestoneVerification[]
  
  @@map("daos")
}

model DAOProposal {
  id              String   @id @default(cuid())
  daoId           String
  title           String
  description     String
  proposer        String
  status          String   @default("DRAFT") // 'DRAFT', 'ACTIVE', 'PASSED', 'FAILED', 'EXECUTED', 'CANCELLED'
  category        String   // 'INVESTMENT', 'GOVERNANCE', 'TREASURY', 'MEMBERSHIP'
  requestedAmount Float?
  votesFor        Float    @default(0)
  votesAgainst    Float    @default(0)
  votesAbstain    Float    @default(0)
  totalVotes      Float    @default(0)
  quorum          Float
  threshold       Float    @default(60)
  startTime       DateTime
  endTime         DateTime
  executionTime   DateTime?
  discussion      String?
  attachments     String?  // JSON array
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  dao             DAO      @relation(fields: [daoId], references: [id], onDelete: Cascade)
  votes           DAOVote[]
  fundingRequests DAOFundingRequest[]
  
  @@map("dao_proposals")
}

model DAOProject {
  id              String   @id @default(cuid())
  daoId           String
  title           String
  description     String
  status          String   @default("PLANNING") // 'PLANNING', 'ACTIVE', 'MILESTONE_PENDING', 'COMPLETED', 'CANCELLED'
  category        String
  totalBudget     Float
  allocatedFunds  Float    @default(0)
  spentFunds      Float    @default(0)
  roi             Float    @default(0)
  riskLevel       String   // 'LOW', 'MEDIUM', 'HIGH'
  teamMembers     String   // JSON array
  startDate       DateTime
  expectedEndDate DateTime
  completedDate   DateTime?
  tokenReward     Float    @default(0) // Governance tokens earned upon completion
  createdBy       String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  dao             DAO      @relation(fields: [daoId], references: [id], onDelete: Cascade)
  milestones      DAOMilestone[]
  tasks           DAOTask[]
  verifications   DAOMilestoneVerification[]
  
  @@map("dao_projects")
}

model DAOMilestone {
  id              String   @id @default(cuid())
  projectId       String
  title           String
  description     String
  targetDate      DateTime
  completedDate   DateTime?
  budget          Float
  status          String   @default("PENDING") // 'PENDING', 'IN_PROGRESS', 'COMPLETED', 'VERIFIED', 'PAID'
  deliverables    String   // JSON array
  verificationReq Float    @default(51) // percentage of voting power needed
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  project         DAOProject @relation(fields: [projectId], references: [id], onDelete: Cascade)
  verifications   DAOMilestoneVerification[]
  
  @@map("dao_milestones")
}

model DAOMember {
  id              String   @id @default(cuid())
  daoId           String
  userId          String
  address         String
  role            String   @default("MEMBER") // 'CHAIR', 'ADMIN', 'MEMBER'
  votingPower     Float    @default(0)
  reputation      Float    @default(50)
  contributionScore Float  @default(0)
  delegatedTo     String?
  delegatedFrom   String?  // JSON array
  proposalsCreated Int     @default(0)
  votesParticipated Int    @default(0)
  joinDate        DateTime @default(now())
  lastActivity    DateTime @default(now())
  status          String   @default("ACTIVE") // 'ACTIVE', 'INACTIVE', 'SUSPENDED'
  
  // Relations
  dao             DAO      @relation(fields: [daoId], references: [id], onDelete: Cascade)
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  votes           DAOVote[]
  fundingReviews  DAOFundingReview[]
  verificationReviews DAOVerificationReview[]
  
  @@unique([daoId, userId])
  @@map("dao_members")
}

model DAOVote {
  id              String   @id @default(cuid())
  proposalId      String
  memberId        String
  voteType        String   // 'FOR', 'AGAINST', 'ABSTAIN'
  votingPower     Float
  reason          String?
  timestamp       DateTime @default(now())
  
  // Relations
  proposal        DAOProposal @relation(fields: [proposalId], references: [id], onDelete: Cascade)
  member          DAOMember   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  
  @@unique([proposalId, memberId])
  @@map("dao_votes")
}

model DAOTreasury {
  id              String   @id @default(cuid())
  daoId           String
  type            String   // 'DEPOSIT', 'WITHDRAWAL', 'INVESTMENT', 'REWARD', 'FEE', 'MILESTONE_PAYMENT'
  amount          Float
  token           String
  from            String?
  to              String?
  description     String
  proposalId      String?
  projectId       String?
  txHash          String?
  status          String   @default("PENDING") // 'PENDING', 'CONFIRMED', 'FAILED'
  timestamp       DateTime @default(now())
  
  // Relations
  dao             DAO      @relation(fields: [daoId], references: [id], onDelete: Cascade)
  
  @@map("dao_treasury")
}

model DAODistribution {
  id              String   @id @default(cuid())
  daoId           String
  name            String
  method          String   // 'TOKEN_HOLDING', 'CONTRIBUTION', 'EQUAL', 'CUSTOM'
  frequency       String   // 'DAILY', 'WEEKLY', 'MONTHLY', 'QUARTERLY'
  isActive        Boolean  @default(true)
  totalDistributed Float   @default(0)
  eligibleMembers Int      @default(0)
  lastDistribution DateTime?
  nextDistribution DateTime
  rules           String?  // JSON configuration
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  dao             DAO      @relation(fields: [daoId], references: [id], onDelete: Cascade)
  
  @@map("dao_distributions")
}

model DAOTask {
  id              String   @id @default(cuid())
  projectId       String
  title           String
  description     String
  status          String   @default("TODO") // 'TODO', 'IN_PROGRESS', 'REVIEW', 'COMPLETED'
  priority        String   @default("MEDIUM") // 'LOW', 'MEDIUM', 'HIGH', 'URGENT'
  assigneeId      String?  // User ID of assigned member
  costEstimate    Float    @default(0) // SOL cost for completing task
  tokenReward     Float    @default(0) // Governance tokens earned upon completion
  dueDate         DateTime?
  completedDate   DateTime?
  attachments     String?  // JSON array of file URLs
  tags            String?  // JSON array of tags
  createdBy       String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  project         DAOProject @relation(fields: [projectId], references: [id], onDelete: Cascade)
  
  @@map("dao_tasks")
}

model DAOFundingRequest {
  id                String   @id @default(cuid())
  daoId             String
  proposalId        String?
  requestType       String   // 'PROJECT_FUNDING', 'MILESTONE_PAYMENT', 'EMERGENCY_FUND', 'OPERATIONAL_EXPENSES'
  amount            Float
  token             String
  recipient         String
  purpose           String
  justification     String
  requiredDocuments String   // JSON array
  attachments       String?  // JSON array
  status            String   @default("DRAFT") // 'DRAFT', 'SUBMITTED', 'UNDER_REVIEW', 'APPROVED', 'REJECTED', 'EXECUTED'
  reviewers         String   // JSON array of reviewer IDs
  approvalThreshold Float
  currentApprovals  Float    @default(0)
  reviewDeadline    DateTime
  rejectionReason   String?
  executedAt        DateTime?
  executorId        String?
  transactionId     String?
  createdBy         String
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  // Relations
  dao               DAO      @relation(fields: [daoId], references: [id], onDelete: Cascade)
  proposal          DAOProposal? @relation(fields: [proposalId], references: [id])
  reviews           DAOFundingReview[]
  
  @@map("dao_funding_requests")
}

model DAOFundingReview {
  id              String   @id @default(cuid())
  requestId       String
  reviewerId      String
  decision        String   // 'APPROVE', 'REJECT', 'REQUEST_CHANGES'
  comments        String
  attachments     String?  // JSON array
  votingPower     Float
  timestamp       DateTime @default(now())
  
  // Relations
  request         DAOFundingRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  reviewer        DAOMember @relation(fields: [reviewerId], references: [id], onDelete: Cascade)
  
  @@unique([requestId, reviewerId])
  @@map("dao_funding_reviews")
}

model DAOMilestoneVerification {
  id                    String   @id @default(cuid())
  milestoneId           String
  projectId             String
  daoId                 String
  verificationMethod    String   // 'PEER_REVIEW', 'AUTOMATED_CHECK', 'EXTERNAL_AUDIT', 'DELIVERABLE_SUBMISSION'
  requiredEvidence      String   // JSON array
  submittedEvidence     String   // JSON array
  verifiers             String   // JSON array of verifier IDs
  verificationThreshold Float
  currentApprovals      Float    @default(0)
  status                String   @default("PENDING") // 'PENDING', 'UNDER_REVIEW', 'VERIFIED', 'REJECTED', 'PAYMENT_PROCESSED'
  submittedBy           String
  verificationNotes     String?
  verificationDeadline  DateTime
  verifiedAt            DateTime?
  rejectionReason       String?
  paymentTransactionId  String?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  // Relations
  dao                   DAO      @relation(fields: [daoId], references: [id], onDelete: Cascade)
  project               DAOProject @relation(fields: [projectId], references: [id], onDelete: Cascade)
  milestone             DAOMilestone @relation(fields: [milestoneId], references: [id], onDelete: Cascade)
  reviews               DAOVerificationReview[]
  
  @@map("dao_milestone_verifications")
}

model DAOVerificationReview {
  id               String   @id @default(cuid())
  verificationId   String
  reviewerId       String
  decision         String   // 'APPROVE', 'REJECT', 'REQUEST_MORE_EVIDENCE'
  comments         String
  evidenceChecked  String   // JSON array
  votingPower      Float
  timestamp        DateTime @default(now())
  
  // Relations
  verification     DAOMilestoneVerification @relation(fields: [verificationId], references: [id], onDelete: Cascade)
  reviewer         DAOMember @relation(fields: [reviewerId], references: [id], onDelete: Cascade)
  
  @@unique([verificationId, reviewerId])
  @@map("dao_verification_reviews")
}

model PriceAlert {
  id           String   @id @default(cuid())
  userId       String
  symbol       String   // 交易对符号，如 "BTCUSDT"
  targetPrice  Float    // 目标价格
  condition    String   // 'above', 'below', 'crosses_above', 'crosses_below'
  exchange     String   // 交易所：'binance', 'okx', 'gate'
  message      String?  // 自定义消息
  isActive     Boolean  @default(true)
  isTriggered  Boolean  @default(false)
  triggeredAt  DateTime?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  // Relations
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@index([symbol])
  @@index([isActive, isTriggered])
  @@map("price_alerts")
}

model FavoriteSymbol {
  id          String   @id @default(cuid())
  userId      String
  symbol      String   // 交易对符号，如 "BTCUSDT"
  baseAsset   String   // 基础资产，如 "BTC"
  quoteAsset  String   // 计价资产，如 "USDT"
  addedAt     DateTime @default(now())
  
  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([userId, symbol])
  @@index([userId])
  @@index([symbol])
  @@map("favorite_symbols")
}

// 交易所币种信息表
model ExchangeSymbol {
  id                String   @id @default(cuid())
  symbol            String   // 交易对符号，如 "BTCUSDT"
  baseAsset         String   // 基础资产，如 "BTC"  
  quoteAsset        String   // 计价资产，如 "USDT"
  exchange          String   // 交易所：'binance', 'okx', 'gate'
  status            String   // 交易状态：'TRADING', 'BREAK', 'HALT'
  isSpotTradingAllowed Boolean @default(true)
  isMarginTradingAllowed Boolean @default(false)
  baseAssetPrecision Int     @default(8)
  quotePrecision     Int     @default(8)
  orderTypes         String  // JSON数组：['LIMIT', 'MARKET', 'STOP_LOSS']
  timeInForce        String  // JSON数组：['GTC', 'IOC', 'FOK']
  filters            String  // JSON对象：价格过滤器、数量过滤器等
  permissions        String  // JSON数组：['SPOT', 'MARGIN']
  defaultSelfTradePreventionMode String? // 自我交易防范模式
  allowedSelfTradePreventionModes String? // JSON数组
  volume24h          Float?   // 24小时交易量
  priceChange24h     Float?   // 24小时价格变化
  priceChangePercent24h Float? // 24小时价格变化百分比
  lastPrice          Float?   // 最新价格
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  
  @@unique([symbol, exchange])
  @@index([exchange])
  @@index([baseAsset])
  @@index([quoteAsset])
  @@index([status])
  @@index([updatedAt])
  @@map("exchange_symbols")
}

// 快讯表
model NewsFeed {
  id           String   @id @default(cuid())
  title        String   // 快讯标题
  content      String   // 快讯内容
  summary      String?  // 快讯摘要
  source       String   // 数据源：'cex', 'onchain', 'social', 'defi'
  sourceUrl    String?  // 原始链接
  category     String   // 分类：'listing', 'delisting', 'trading', 'security', 'market', 'general'
  importance   String   @default("medium") // 重要性：'high', 'medium', 'low'
  exchange     String?  // 相关交易所（如果适用）
  symbols      String   // JSON数组：相关交易对
  tags         String   // JSON数组：标签
  metadata     String?  // JSON对象：额外元数据
  isHot        Boolean  @default(false) // 是否为热门快讯
  isVerified   Boolean  @default(false) // 是否已验证
  publishTime  DateTime // 发布时间
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@index([source])
  @@index([category])
  @@index([importance])
  @@index([exchange])
  @@index([isHot])
  @@index([publishTime])
  @@index([createdAt])
  @@map("news_feeds")
}

// 链上数据快讯表
model OnChainFeed {
  id              String   @id @default(cuid())
  transactionHash String   // 交易哈希
  blockNumber     BigInt   // 区块号
  blockchain      String   // 区块链：'ethereum', 'solana', 'bsc'
  eventType       String   // 事件类型：'large_transfer', 'whale_activity', 'dex_swap', 'nft_trade'
  title           String   // 标题
  description     String   // 描述
  amount          String?  // 金额（字符串以支持大数）
  tokenSymbol     String?  // 代币符号
  tokenAddress    String?  // 代币合约地址
  fromAddress     String?  // 发送地址
  toAddress       String?  // 接收地址
  dexName         String?  // DEX名称（如适用）
  nftCollection   String?  // NFT集合（如适用）
  value           Float?   // 价值（USD）
  gasUsed         String?  // 消耗的gas
  gasPrice        String?  // gas价格
  metadata        String?  // JSON对象：额外元数据
  isAlert         Boolean  @default(false) // 是否为警报级别
  timestamp       DateTime // 区块时间
  createdAt       DateTime @default(now())
  
  @@unique([transactionHash, blockchain])
  @@index([blockchain])
  @@index([eventType])
  @@index([tokenSymbol])
  @@index([fromAddress])
  @@index([toAddress])
  @@index([value])
  @@index([isAlert])
  @@index([timestamp])
  @@map("onchain_feeds")
}

// CEX交易所公告表
model CEXAnnouncement {
  id          String   @id @default(cuid())
  exchangeId  String   // 交易所特有的公告ID，如 "binance_12345"
  exchange    String   // 交易所：'binance', 'okx', 'bybit', 'kucoin', 'gate', 'huobi', 'coinbase', 'kraken', 'bitget'
  title       String   // 公告标题
  content     String   // 公告内容
  category    String   // 分类：'listing', 'delisting', 'trading', 'derivatives', 'earn', 'maintenance', 'promotion', 'security', 'wallet', 'api', 'mobile', 'regulatory', 'service', 'general'
  importance  String   @default("medium") // 重要性：'high', 'medium', 'low'
  publishTime DateTime // 发布时间
  tags        String   // JSON数组：相关标签
  url         String   // 原始链接
  isProcessed Boolean  @default(false) // 是否已处理（用于增量更新）
  hash        String?  // 内容哈希值（用于去重）
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([exchangeId, exchange])
  @@index([exchange])
  @@index([category])
  @@index([importance])
  @@index([publishTime])
  @@index([isProcessed])
  @@index([hash])
  @@index([createdAt])
  @@map("cex_announcements")
}

// 用户快讯偏好表
model UserNewsPreference {
  id            String   @id @default(cuid())
  userId        String
  sources       String   // JSON数组：关注的数据源
  categories    String   // JSON数组：关注的分类
  symbols       String   // JSON数组：关注的交易对
  exchanges     String   // JSON数组：关注的交易所
  importance    String   @default("medium") // 最小重要性级别
  enableAlerts  Boolean  @default(true) // 是否启用警报
  alertEmail    Boolean  @default(false) // 是否发送邮件警报
  alertPush     Boolean  @default(true) // 是否发送推送警报
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // Relations
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([userId])
  @@index([userId])
  @@map("user_news_preferences")
}

// 活跃空投项目表
model ActiveAirdrop {
  id              String   @id @default(cuid())
  project         String   // 项目名称
  chain           String   // 区块链：'Solana', 'Ethereum', 'BSC', 'Polygon', 'Arbitrum'
  deadline        String?  // 截止日期（字符串格式）
  requirements    String   // 任务要求
  estimatedValue  String   // 预估价值
  category        String   @default("DeFi") // 项目类别：'DeFi', 'NFT', 'GameFi', 'Infrastructure'
  difficulty      String   @default("Medium") // 难度：'Easy', 'Medium', 'Hard'
  status          String   @default("Active") // 状态：'Active', 'Ended', 'Paused'
  officialUrl     String?  // 官方链接
  twitterUrl      String?  // Twitter链接
  discordUrl      String?  // Discord链接
  description     String?  // 项目描述
  tags            String   // JSON数组：标签
  isHot           Boolean  @default(false) // 是否为热门项目
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  userProjects    UserAirdropProject[]
  
  @@index([chain])
  @@index([status])
  @@index([isHot])
  @@index([createdAt])
  @@map("active_airdrops")
}

// 用户空投项目表（我的项目）
model UserAirdropProject {
  id              String   @id @default(cuid())
  userId          String   // 用户ID，关联钱包地址
  walletAddress   String   // 钱包地址
  airdropId       String   // 关联的活跃空投ID
  project         String   // 项目名称
  chain           String   // 区块链
  accountCount    Int      @default(0) // 起号数量
  ipCount         Int      @default(0) // IP数量
  status          String   @default("In Progress") // 状态：'In Progress', 'Completed', 'Failed'
  progressNotes   String?  // 进度备注
  claimedDate     String?  // 完成/领取日期
  claimedAmount   String?  // 领取数量
  estimatedValue  String?  // 预估价值
  actualValue     String?  // 实际价值
  txHash          String?  // 领取交易哈希
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  airdrop         ActiveAirdrop @relation(fields: [airdropId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@index([walletAddress])
  @@index([airdropId])
  @@index([status])
  @@index([createdAt])
  @@map("user_airdrop_projects")
}

// 每日奖励记录表
model DailyReward {
  id              String   @id @default(cuid())
  userId          String   // 用户ID
  date            String   // 日期 YYYY-MM-DD 格式
  totalRewardsUSD Float    @default(0) // 当日总奖励（美元）
  breakdown       String   // JSON对象：各代币奖励详情 {"FIL": {"amount": 50.25, "price": 2.28, "usd": 114.57}}
  nodeCount       Int      @default(0) // 参与奖励的节点数量
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@unique([userId, date])
  @@index([userId])
  @@index([date])
  @@index([userId, date])
  @@map("daily_rewards")
}

// 交易日志模型
model JournalFolder {
  id              String   @id @default(cuid())
  walletAddress   String   // 钱包地址
  userId          String?  // 用户ID（可选）
  name            String   // 文件夹名称
  description     String?  // 文件夹描述
  color           String   @default("#3B82F6") // 文件夹颜色
  icon            String   @default("📁") // 文件夹图标
  parentId        String?  // 父文件夹ID，支持嵌套
  sortOrder       Int      @default(0) // 排序顺序
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  user            User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  parent          JournalFolder? @relation("FolderHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children        JournalFolder[] @relation("FolderHierarchy")
  entries         JournalEntry[]
  
  @@index([walletAddress])
  @@index([userId])
  @@index([parentId])
  @@map("journal_folders")
}

model JournalEntry {
  id              String   @id @default(cuid())
  walletAddress   String   // 钱包地址
  userId          String?  // 用户ID（可选）
  folderId        String?  // 所属文件夹ID
  title           String
  content         String   // HTML内容
  excerpt         String?  // 摘要
  category        String   // 分类
  tags            String   // JSON数组的标签
  tradeData       String?  // JSON对象，交易相关数据（价格、数量、盈亏等）
  imageUrls       String?  // JSON数组的图片URL
  isPublic        Boolean  @default(false) // 是否公开
  sentiment       String?  // 市场情绪: 'bullish', 'bearish', 'neutral'
  sortOrder       Int      @default(0) // 排序顺序
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  user            User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  folder          JournalFolder? @relation(fields: [folderId], references: [id], onDelete: SetNull)
  
  @@index([walletAddress])
  @@index([userId])
  @@index([folderId])
  @@index([category])
  @@index([createdAt])
  @@map("journal_entries")
}
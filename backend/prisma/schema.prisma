// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id              String   @id @default(cuid())
  walletAddress   String   @unique
  publicKey       String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  lastLogin       DateTime?
  settings        String?  // JSON string for user preferences and settings
  
  // Relations
  nodes           UserNode[]
  roiCalculations ROICalculation[]
  daoMemberships  DAOMember[]
  priceAlerts     PriceAlert[]
  favoriteSymbols FavoriteSymbol[]
  newsPreference  UserNewsPreference?
  journalEntries  JournalEntry[]
  journalFolders  JournalFolder[]
  
  @@map("users")
}

model DePINProject {
  id                 String   @id @default(cuid())
  name               String   @unique
  category           String   // 'STORAGE', 'COMPUTING', 'WIRELESS', 'SENSORS'
  description        String
  blockchain         String
  tokenSymbol        String
  tokenPrice         Float    @default(0)
  marketCap          String   @default("$0")
  volume24h          String   @default("$0")
  apy                String
  status             String   @default("ACTIVE") // 'ACTIVE', 'INACTIVE', 'MAINTENANCE'
  minInvestment      Float
  roiPeriod          Int      // in months
  geographicFocus    String   // JSON string array of countries/regions
  riskLevel          String   // 'LOW', 'MEDIUM', 'HIGH'
  hardwareRequirements String // JSON string array of hardware specs
  websiteUrl         String?  // Official website URL
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  
  // Relations
  nodes              UserNode[]
  roiCalculations    ROICalculation[]
  
  @@map("depin_projects")
}

model UserNode {
  id            String   @id @default(cuid())
  userId        String
  projectId     String
  nodeId        String   // User-defined node ID
  type          String
  capacity      String?
  location      String?
  monitorUrl    String?
  status        String   @default("SYNCING") // 'ONLINE', 'OFFLINE', 'SYNCING', 'ERROR'
  uptime        String   @default("0%")
  earnings      String   @default("$0/day")
  totalEarned   Float    @default(0)
  startDate     DateTime @default(now())
  hardware      String?  // JSON string of hardware specifications
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // Relations
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  project       DePINProject @relation(fields: [projectId], references: [id])
  performances  NodePerformance[]
  
  @@unique([userId, nodeId]) // Unique node ID per user
  @@map("user_nodes")
}

model NodePerformance {
  id             String   @id @default(cuid())
  nodeId         String
  cpuUsage       Float
  memoryUsage    Float
  diskUsage      Float
  networkLatency Float
  bandwidthUp    Float
  bandwidthDown  Float
  timestamp      DateTime @default(now())
  
  // Relations
  node           UserNode @relation(fields: [nodeId], references: [id], onDelete: Cascade)
  
  @@map("node_performances")
}

model ROICalculation {
  id                    String   @id @default(cuid())
  userId                String
  projectId             String
  location              String
  hardwareCost          Float
  monthlyCost           Float
  estimatedMonthlyReward Float
  roiMonths             Float
  annualROI             Float
  riskFactors           String   // JSON string array
  createdAt             DateTime @default(now())
  
  // Relations
  user                  User     @relation(fields: [userId], references: [id])
  project               DePINProject @relation(fields: [projectId], references: [id])
  
  @@map("roi_calculations")
}

model SystemNotification {
  id          String   @id @default(cuid())
  userId      String?  // null for system-wide notifications
  type        String   // 'NODE_STATUS', 'EARNINGS_UPDATE', 'SYSTEM_ALERT', 'CAPACITY_UPDATE'
  title       String
  message     String
  isRead      Boolean  @default(false)
  data        String?  // JSON string for additional notification data
  createdAt   DateTime @default(now())
  
  @@map("system_notifications")
}

// DAO Models
model DAO {
  id              String   @id @default(cuid())
  name            String   @unique
  description     String
  treasuryAddress String
  governanceToken String
  totalSupply     Float    @default(0)
  quorumThreshold Float    @default(50) // percentage
  votingPeriod    Int      @default(7) // days
  status          String   @default("ACTIVE") // 'ACTIVE', 'PAUSED', 'DISSOLVED'
  createdBy       String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  proposals       DAOProposal[]
  projects        DAOProject[]
  members         DAOMember[]
  treasury        DAOTreasury[]
  distributions   DAODistribution[]
  fundingRequests DAOFundingRequest[]
  milestoneVerifications DAOMilestoneVerification[]
  
  @@map("daos")
}

model DAOProposal {
  id              String   @id @default(cuid())
  daoId           String
  title           String
  description     String
  proposer        String
  status          String   @default("DRAFT") // 'DRAFT', 'ACTIVE', 'PASSED', 'FAILED', 'EXECUTED', 'CANCELLED'
  category        String   // 'INVESTMENT', 'GOVERNANCE', 'TREASURY', 'MEMBERSHIP'
  requestedAmount Float?
  votesFor        Float    @default(0)
  votesAgainst    Float    @default(0)
  votesAbstain    Float    @default(0)
  totalVotes      Float    @default(0)
  quorum          Float
  threshold       Float    @default(60)
  startTime       DateTime
  endTime         DateTime
  executionTime   DateTime?
  discussion      String?
  attachments     String?  // JSON array
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  dao             DAO      @relation(fields: [daoId], references: [id], onDelete: Cascade)
  votes           DAOVote[]
  fundingRequests DAOFundingRequest[]
  
  @@map("dao_proposals")
}

model DAOProject {
  id              String   @id @default(cuid())
  daoId           String
  title           String
  description     String
  status          String   @default("PLANNING") // 'PLANNING', 'ACTIVE', 'MILESTONE_PENDING', 'COMPLETED', 'CANCELLED'
  category        String
  totalBudget     Float
  allocatedFunds  Float    @default(0)
  spentFunds      Float    @default(0)
  roi             Float    @default(0)
  riskLevel       String   // 'LOW', 'MEDIUM', 'HIGH'
  teamMembers     String   // JSON array
  startDate       DateTime
  expectedEndDate DateTime
  completedDate   DateTime?
  tokenReward     Float    @default(0) // Governance tokens earned upon completion
  createdBy       String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  dao             DAO      @relation(fields: [daoId], references: [id], onDelete: Cascade)
  milestones      DAOMilestone[]
  tasks           DAOTask[]
  verifications   DAOMilestoneVerification[]
  
  @@map("dao_projects")
}

model DAOMilestone {
  id              String   @id @default(cuid())
  projectId       String
  title           String
  description     String
  targetDate      DateTime
  completedDate   DateTime?
  budget          Float
  status          String   @default("PENDING") // 'PENDING', 'IN_PROGRESS', 'COMPLETED', 'VERIFIED', 'PAID'
  deliverables    String   // JSON array
  verificationReq Float    @default(51) // percentage of voting power needed
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  project         DAOProject @relation(fields: [projectId], references: [id], onDelete: Cascade)
  verifications   DAOMilestoneVerification[]
  
  @@map("dao_milestones")
}

model DAOMember {
  id              String   @id @default(cuid())
  daoId           String
  userId          String
  address         String
  role            String   @default("MEMBER") // 'CHAIR', 'ADMIN', 'MEMBER'
  votingPower     Float    @default(0)
  reputation      Float    @default(50)
  contributionScore Float  @default(0)
  delegatedTo     String?
  delegatedFrom   String?  // JSON array
  proposalsCreated Int     @default(0)
  votesParticipated Int    @default(0)
  joinDate        DateTime @default(now())
  lastActivity    DateTime @default(now())
  status          String   @default("ACTIVE") // 'ACTIVE', 'INACTIVE', 'SUSPENDED'
  
  // Relations
  dao             DAO      @relation(fields: [daoId], references: [id], onDelete: Cascade)
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  votes           DAOVote[]
  fundingReviews  DAOFundingReview[]
  verificationReviews DAOVerificationReview[]
  
  @@unique([daoId, userId])
  @@map("dao_members")
}

model DAOVote {
  id              String   @id @default(cuid())
  proposalId      String
  memberId        String
  voteType        String   // 'FOR', 'AGAINST', 'ABSTAIN'
  votingPower     Float
  reason          String?
  timestamp       DateTime @default(now())
  
  // Relations
  proposal        DAOProposal @relation(fields: [proposalId], references: [id], onDelete: Cascade)
  member          DAOMember   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  
  @@unique([proposalId, memberId])
  @@map("dao_votes")
}

model DAOTreasury {
  id              String   @id @default(cuid())
  daoId           String
  type            String   // 'DEPOSIT', 'WITHDRAWAL', 'INVESTMENT', 'REWARD', 'FEE', 'MILESTONE_PAYMENT'
  amount          Float
  token           String
  from            String?
  to              String?
  description     String
  proposalId      String?
  projectId       String?
  txHash          String?
  status          String   @default("PENDING") // 'PENDING', 'CONFIRMED', 'FAILED'
  timestamp       DateTime @default(now())
  
  // Relations
  dao             DAO      @relation(fields: [daoId], references: [id], onDelete: Cascade)
  
  @@map("dao_treasury")
}

model DAODistribution {
  id              String   @id @default(cuid())
  daoId           String
  name            String
  method          String   // 'TOKEN_HOLDING', 'CONTRIBUTION', 'EQUAL', 'CUSTOM'
  frequency       String   // 'DAILY', 'WEEKLY', 'MONTHLY', 'QUARTERLY'
  isActive        Boolean  @default(true)
  totalDistributed Float   @default(0)
  eligibleMembers Int      @default(0)
  lastDistribution DateTime?
  nextDistribution DateTime
  rules           String?  // JSON configuration
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  dao             DAO      @relation(fields: [daoId], references: [id], onDelete: Cascade)
  
  @@map("dao_distributions")
}

model DAOTask {
  id              String   @id @default(cuid())
  projectId       String
  title           String
  description     String
  status          String   @default("TODO") // 'TODO', 'IN_PROGRESS', 'REVIEW', 'COMPLETED'
  priority        String   @default("MEDIUM") // 'LOW', 'MEDIUM', 'HIGH', 'URGENT'
  assigneeId      String?  // User ID of assigned member
  costEstimate    Float    @default(0) // SOL cost for completing task
  tokenReward     Float    @default(0) // Governance tokens earned upon completion
  dueDate         DateTime?
  completedDate   DateTime?
  attachments     String?  // JSON array of file URLs
  tags            String?  // JSON array of tags
  createdBy       String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  project         DAOProject @relation(fields: [projectId], references: [id], onDelete: Cascade)
  
  @@map("dao_tasks")
}

model DAOFundingRequest {
  id                String   @id @default(cuid())
  daoId             String
  proposalId        String?
  requestType       String   // 'PROJECT_FUNDING', 'MILESTONE_PAYMENT', 'EMERGENCY_FUND', 'OPERATIONAL_EXPENSES'
  amount            Float
  token             String
  recipient         String
  purpose           String
  justification     String
  requiredDocuments String   // JSON array
  attachments       String?  // JSON array
  status            String   @default("DRAFT") // 'DRAFT', 'SUBMITTED', 'UNDER_REVIEW', 'APPROVED', 'REJECTED', 'EXECUTED'
  reviewers         String   // JSON array of reviewer IDs
  approvalThreshold Float
  currentApprovals  Float    @default(0)
  reviewDeadline    DateTime
  rejectionReason   String?
  executedAt        DateTime?
  executorId        String?
  transactionId     String?
  createdBy         String
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  // Relations
  dao               DAO      @relation(fields: [daoId], references: [id], onDelete: Cascade)
  proposal          DAOProposal? @relation(fields: [proposalId], references: [id])
  reviews           DAOFundingReview[]
  
  @@map("dao_funding_requests")
}

model DAOFundingReview {
  id              String   @id @default(cuid())
  requestId       String
  reviewerId      String
  decision        String   // 'APPROVE', 'REJECT', 'REQUEST_CHANGES'
  comments        String
  attachments     String?  // JSON array
  votingPower     Float
  timestamp       DateTime @default(now())
  
  // Relations
  request         DAOFundingRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  reviewer        DAOMember @relation(fields: [reviewerId], references: [id], onDelete: Cascade)
  
  @@unique([requestId, reviewerId])
  @@map("dao_funding_reviews")
}

model DAOMilestoneVerification {
  id                    String   @id @default(cuid())
  milestoneId           String
  projectId             String
  daoId                 String
  verificationMethod    String   // 'PEER_REVIEW', 'AUTOMATED_CHECK', 'EXTERNAL_AUDIT', 'DELIVERABLE_SUBMISSION'
  requiredEvidence      String   // JSON array
  submittedEvidence     String   // JSON array
  verifiers             String   // JSON array of verifier IDs
  verificationThreshold Float
  currentApprovals      Float    @default(0)
  status                String   @default("PENDING") // 'PENDING', 'UNDER_REVIEW', 'VERIFIED', 'REJECTED', 'PAYMENT_PROCESSED'
  submittedBy           String
  verificationNotes     String?
  verificationDeadline  DateTime
  verifiedAt            DateTime?
  rejectionReason       String?
  paymentTransactionId  String?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  // Relations
  dao                   DAO      @relation(fields: [daoId], references: [id], onDelete: Cascade)
  project               DAOProject @relation(fields: [projectId], references: [id], onDelete: Cascade)
  milestone             DAOMilestone @relation(fields: [milestoneId], references: [id], onDelete: Cascade)
  reviews               DAOVerificationReview[]
  
  @@map("dao_milestone_verifications")
}

model DAOVerificationReview {
  id               String   @id @default(cuid())
  verificationId   String
  reviewerId       String
  decision         String   // 'APPROVE', 'REJECT', 'REQUEST_MORE_EVIDENCE'
  comments         String
  evidenceChecked  String   // JSON array
  votingPower      Float
  timestamp        DateTime @default(now())
  
  // Relations
  verification     DAOMilestoneVerification @relation(fields: [verificationId], references: [id], onDelete: Cascade)
  reviewer         DAOMember @relation(fields: [reviewerId], references: [id], onDelete: Cascade)
  
  @@unique([verificationId, reviewerId])
  @@map("dao_verification_reviews")
}

model PriceAlert {
  id           String   @id @default(cuid())
  userId       String
  symbol       String   // äº¤æ˜“å¯¹ç¬¦å·ï¼Œå¦‚ "BTCUSDT"
  targetPrice  Float    // ç›®æ ‡ä»·æ ¼
  condition    String   // 'above', 'below', 'crosses_above', 'crosses_below'
  exchange     String   // äº¤æ˜“æ‰€ï¼š'binance', 'okx', 'gate'
  message      String?  // è‡ªå®šä¹‰æ¶ˆæ¯
  isActive     Boolean  @default(true)
  isTriggered  Boolean  @default(false)
  triggeredAt  DateTime?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  // Relations
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@index([symbol])
  @@index([isActive, isTriggered])
  @@map("price_alerts")
}

model FavoriteSymbol {
  id          String   @id @default(cuid())
  userId      String
  symbol      String   // äº¤æ˜“å¯¹ç¬¦å·ï¼Œå¦‚ "BTCUSDT"
  baseAsset   String   // åŸºç¡€èµ„äº§ï¼Œå¦‚ "BTC"
  quoteAsset  String   // è®¡ä»·èµ„äº§ï¼Œå¦‚ "USDT"
  addedAt     DateTime @default(now())
  
  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([userId, symbol])
  @@index([userId])
  @@index([symbol])
  @@map("favorite_symbols")
}

// äº¤æ˜“æ‰€å¸ç§ä¿¡æ¯è¡¨
model ExchangeSymbol {
  id                String   @id @default(cuid())
  symbol            String   // äº¤æ˜“å¯¹ç¬¦å·ï¼Œå¦‚ "BTCUSDT"
  baseAsset         String   // åŸºç¡€èµ„äº§ï¼Œå¦‚ "BTC"  
  quoteAsset        String   // è®¡ä»·èµ„äº§ï¼Œå¦‚ "USDT"
  exchange          String   // äº¤æ˜“æ‰€ï¼š'binance', 'okx', 'gate'
  status            String   // äº¤æ˜“çŠ¶æ€ï¼š'TRADING', 'BREAK', 'HALT'
  isSpotTradingAllowed Boolean @default(true)
  isMarginTradingAllowed Boolean @default(false)
  baseAssetPrecision Int     @default(8)
  quotePrecision     Int     @default(8)
  orderTypes         String  // JSONæ•°ç»„ï¼š['LIMIT', 'MARKET', 'STOP_LOSS']
  timeInForce        String  // JSONæ•°ç»„ï¼š['GTC', 'IOC', 'FOK']
  filters            String  // JSONå¯¹è±¡ï¼šä»·æ ¼è¿‡æ»¤å™¨ã€æ•°é‡è¿‡æ»¤å™¨ç­‰
  permissions        String  // JSONæ•°ç»„ï¼š['SPOT', 'MARGIN']
  defaultSelfTradePreventionMode String? // è‡ªæˆ‘äº¤æ˜“é˜²èŒƒæ¨¡å¼
  allowedSelfTradePreventionModes String? // JSONæ•°ç»„
  volume24h          Float?   // 24å°æ—¶äº¤æ˜“é‡
  priceChange24h     Float?   // 24å°æ—¶ä»·æ ¼å˜åŒ–
  priceChangePercent24h Float? // 24å°æ—¶ä»·æ ¼å˜åŒ–ç™¾åˆ†æ¯”
  lastPrice          Float?   // æœ€æ–°ä»·æ ¼
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  
  @@unique([symbol, exchange])
  @@index([exchange])
  @@index([baseAsset])
  @@index([quoteAsset])
  @@index([status])
  @@index([updatedAt])
  @@map("exchange_symbols")
}

// å¿«è®¯è¡¨
model NewsFeed {
  id           String   @id @default(cuid())
  title        String   // å¿«è®¯æ ‡é¢˜
  content      String   // å¿«è®¯å†…å®¹
  summary      String?  // å¿«è®¯æ‘˜è¦
  source       String   // æ•°æ®æºï¼š'cex', 'onchain', 'social', 'defi'
  sourceUrl    String?  // åŸå§‹é“¾æ¥
  category     String   // åˆ†ç±»ï¼š'listing', 'delisting', 'trading', 'security', 'market', 'general'
  importance   String   @default("medium") // é‡è¦æ€§ï¼š'high', 'medium', 'low'
  exchange     String?  // ç›¸å…³äº¤æ˜“æ‰€ï¼ˆå¦‚æœé€‚ç”¨ï¼‰
  symbols      String   // JSONæ•°ç»„ï¼šç›¸å…³äº¤æ˜“å¯¹
  tags         String   // JSONæ•°ç»„ï¼šæ ‡ç­¾
  metadata     String?  // JSONå¯¹è±¡ï¼šé¢å¤–å…ƒæ•°æ®
  isHot        Boolean  @default(false) // æ˜¯å¦ä¸ºçƒ­é—¨å¿«è®¯
  isVerified   Boolean  @default(false) // æ˜¯å¦å·²éªŒè¯
  publishTime  DateTime // å‘å¸ƒæ—¶é—´
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@index([source])
  @@index([category])
  @@index([importance])
  @@index([exchange])
  @@index([isHot])
  @@index([publishTime])
  @@index([createdAt])
  @@map("news_feeds")
}

// é“¾ä¸Šæ•°æ®å¿«è®¯è¡¨
model OnChainFeed {
  id              String   @id @default(cuid())
  transactionHash String   // äº¤æ˜“å“ˆå¸Œ
  blockNumber     BigInt   // åŒºå—å·
  blockchain      String   // åŒºå—é“¾ï¼š'ethereum', 'solana', 'bsc'
  eventType       String   // äº‹ä»¶ç±»å‹ï¼š'large_transfer', 'whale_activity', 'dex_swap', 'nft_trade'
  title           String   // æ ‡é¢˜
  description     String   // æè¿°
  amount          String?  // é‡‘é¢ï¼ˆå­—ç¬¦ä¸²ä»¥æ”¯æŒå¤§æ•°ï¼‰
  tokenSymbol     String?  // ä»£å¸ç¬¦å·
  tokenAddress    String?  // ä»£å¸åˆçº¦åœ°å€
  fromAddress     String?  // å‘é€åœ°å€
  toAddress       String?  // æ¥æ”¶åœ°å€
  dexName         String?  // DEXåç§°ï¼ˆå¦‚é€‚ç”¨ï¼‰
  nftCollection   String?  // NFTé›†åˆï¼ˆå¦‚é€‚ç”¨ï¼‰
  value           Float?   // ä»·å€¼ï¼ˆUSDï¼‰
  gasUsed         String?  // æ¶ˆè€—çš„gas
  gasPrice        String?  // gasä»·æ ¼
  metadata        String?  // JSONå¯¹è±¡ï¼šé¢å¤–å…ƒæ•°æ®
  isAlert         Boolean  @default(false) // æ˜¯å¦ä¸ºè­¦æŠ¥çº§åˆ«
  timestamp       DateTime // åŒºå—æ—¶é—´
  createdAt       DateTime @default(now())
  
  @@unique([transactionHash, blockchain])
  @@index([blockchain])
  @@index([eventType])
  @@index([tokenSymbol])
  @@index([fromAddress])
  @@index([toAddress])
  @@index([value])
  @@index([isAlert])
  @@index([timestamp])
  @@map("onchain_feeds")
}

// CEXäº¤æ˜“æ‰€å…¬å‘Šè¡¨
model CEXAnnouncement {
  id          String   @id @default(cuid())
  exchangeId  String   // äº¤æ˜“æ‰€ç‰¹æœ‰çš„å…¬å‘ŠIDï¼Œå¦‚ "binance_12345"
  exchange    String   // äº¤æ˜“æ‰€ï¼š'binance', 'okx', 'bybit', 'kucoin', 'gate', 'huobi', 'coinbase', 'kraken', 'bitget'
  title       String   // å…¬å‘Šæ ‡é¢˜
  content     String   // å…¬å‘Šå†…å®¹
  category    String   // åˆ†ç±»ï¼š'listing', 'delisting', 'trading', 'derivatives', 'earn', 'maintenance', 'promotion', 'security', 'wallet', 'api', 'mobile', 'regulatory', 'service', 'general'
  importance  String   @default("medium") // é‡è¦æ€§ï¼š'high', 'medium', 'low'
  publishTime DateTime // å‘å¸ƒæ—¶é—´
  tags        String   // JSONæ•°ç»„ï¼šç›¸å…³æ ‡ç­¾
  url         String   // åŸå§‹é“¾æ¥
  isProcessed Boolean  @default(false) // æ˜¯å¦å·²å¤„ç†ï¼ˆç”¨äºå¢é‡æ›´æ–°ï¼‰
  hash        String?  // å†…å®¹å“ˆå¸Œå€¼ï¼ˆç”¨äºå»é‡ï¼‰
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([exchangeId, exchange])
  @@index([exchange])
  @@index([category])
  @@index([importance])
  @@index([publishTime])
  @@index([isProcessed])
  @@index([hash])
  @@index([createdAt])
  @@map("cex_announcements")
}

// ç”¨æˆ·å¿«è®¯åå¥½è¡¨
model UserNewsPreference {
  id            String   @id @default(cuid())
  userId        String
  sources       String   // JSONæ•°ç»„ï¼šå…³æ³¨çš„æ•°æ®æº
  categories    String   // JSONæ•°ç»„ï¼šå…³æ³¨çš„åˆ†ç±»
  symbols       String   // JSONæ•°ç»„ï¼šå…³æ³¨çš„äº¤æ˜“å¯¹
  exchanges     String   // JSONæ•°ç»„ï¼šå…³æ³¨çš„äº¤æ˜“æ‰€
  importance    String   @default("medium") // æœ€å°é‡è¦æ€§çº§åˆ«
  enableAlerts  Boolean  @default(true) // æ˜¯å¦å¯ç”¨è­¦æŠ¥
  alertEmail    Boolean  @default(false) // æ˜¯å¦å‘é€é‚®ä»¶è­¦æŠ¥
  alertPush     Boolean  @default(true) // æ˜¯å¦å‘é€æ¨é€è­¦æŠ¥
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // Relations
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([userId])
  @@index([userId])
  @@map("user_news_preferences")
}

// æ´»è·ƒç©ºæŠ•é¡¹ç›®è¡¨
model ActiveAirdrop {
  id              String   @id @default(cuid())
  project         String   // é¡¹ç›®åç§°
  chain           String   // åŒºå—é“¾ï¼š'Solana', 'Ethereum', 'BSC', 'Polygon', 'Arbitrum'
  deadline        String?  // æˆªæ­¢æ—¥æœŸï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼‰
  requirements    String   // ä»»åŠ¡è¦æ±‚
  estimatedValue  String   // é¢„ä¼°ä»·å€¼
  category        String   @default("DeFi") // é¡¹ç›®ç±»åˆ«ï¼š'DeFi', 'NFT', 'GameFi', 'Infrastructure'
  difficulty      String   @default("Medium") // éš¾åº¦ï¼š'Easy', 'Medium', 'Hard'
  status          String   @default("Active") // çŠ¶æ€ï¼š'Active', 'Ended', 'Paused'
  officialUrl     String?  // å®˜æ–¹é“¾æ¥
  twitterUrl      String?  // Twitteré“¾æ¥
  discordUrl      String?  // Discordé“¾æ¥
  description     String?  // é¡¹ç›®æè¿°
  tags            String   // JSONæ•°ç»„ï¼šæ ‡ç­¾
  isHot           Boolean  @default(false) // æ˜¯å¦ä¸ºçƒ­é—¨é¡¹ç›®
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  userProjects    UserAirdropProject[]
  
  @@index([chain])
  @@index([status])
  @@index([isHot])
  @@index([createdAt])
  @@map("active_airdrops")
}

// ç”¨æˆ·ç©ºæŠ•é¡¹ç›®è¡¨ï¼ˆæˆ‘çš„é¡¹ç›®ï¼‰
model UserAirdropProject {
  id              String   @id @default(cuid())
  userId          String   // ç”¨æˆ·IDï¼Œå…³è”é’±åŒ…åœ°å€
  walletAddress   String   // é’±åŒ…åœ°å€
  airdropId       String   // å…³è”çš„æ´»è·ƒç©ºæŠ•ID
  project         String   // é¡¹ç›®åç§°
  chain           String   // åŒºå—é“¾
  accountCount    Int      @default(0) // èµ·å·æ•°é‡
  ipCount         Int      @default(0) // IPæ•°é‡
  status          String   @default("In Progress") // çŠ¶æ€ï¼š'In Progress', 'Completed', 'Failed'
  progressNotes   String?  // è¿›åº¦å¤‡æ³¨
  claimedDate     String?  // å®Œæˆ/é¢†å–æ—¥æœŸ
  claimedAmount   String?  // é¢†å–æ•°é‡
  estimatedValue  String?  // é¢„ä¼°ä»·å€¼
  actualValue     String?  // å®é™…ä»·å€¼
  txHash          String?  // é¢†å–äº¤æ˜“å“ˆå¸Œ
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  airdrop         ActiveAirdrop @relation(fields: [airdropId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@index([walletAddress])
  @@index([airdropId])
  @@index([status])
  @@index([createdAt])
  @@map("user_airdrop_projects")
}

// æ¯æ—¥å¥–åŠ±è®°å½•è¡¨
model DailyReward {
  id              String   @id @default(cuid())
  userId          String   // ç”¨æˆ·ID
  date            String   // æ—¥æœŸ YYYY-MM-DD æ ¼å¼
  totalRewardsUSD Float    @default(0) // å½“æ—¥æ€»å¥–åŠ±ï¼ˆç¾å…ƒï¼‰
  breakdown       String   // JSONå¯¹è±¡ï¼šå„ä»£å¸å¥–åŠ±è¯¦æƒ… {"FIL": {"amount": 50.25, "price": 2.28, "usd": 114.57}}
  nodeCount       Int      @default(0) // å‚ä¸å¥–åŠ±çš„èŠ‚ç‚¹æ•°é‡
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@unique([userId, date])
  @@index([userId])
  @@index([date])
  @@index([userId, date])
  @@map("daily_rewards")
}

// äº¤æ˜“æ—¥å¿—æ¨¡å‹
model JournalFolder {
  id              String   @id @default(cuid())
  walletAddress   String   // é’±åŒ…åœ°å€
  userId          String?  // ç”¨æˆ·IDï¼ˆå¯é€‰ï¼‰
  name            String   // æ–‡ä»¶å¤¹åç§°
  description     String?  // æ–‡ä»¶å¤¹æè¿°
  color           String   @default("#3B82F6") // æ–‡ä»¶å¤¹é¢œè‰²
  icon            String   @default("ğŸ“") // æ–‡ä»¶å¤¹å›¾æ ‡
  parentId        String?  // çˆ¶æ–‡ä»¶å¤¹IDï¼Œæ”¯æŒåµŒå¥—
  sortOrder       Int      @default(0) // æ’åºé¡ºåº
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  user            User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  parent          JournalFolder? @relation("FolderHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children        JournalFolder[] @relation("FolderHierarchy")
  entries         JournalEntry[]
  
  @@index([walletAddress])
  @@index([userId])
  @@index([parentId])
  @@map("journal_folders")
}

model JournalEntry {
  id              String   @id @default(cuid())
  walletAddress   String   // é’±åŒ…åœ°å€
  userId          String?  // ç”¨æˆ·IDï¼ˆå¯é€‰ï¼‰
  folderId        String?  // æ‰€å±æ–‡ä»¶å¤¹ID
  title           String
  content         String   // HTMLå†…å®¹
  excerpt         String?  // æ‘˜è¦
  category        String   // åˆ†ç±»
  tags            String   // JSONæ•°ç»„çš„æ ‡ç­¾
  tradeData       String?  // JSONå¯¹è±¡ï¼Œäº¤æ˜“ç›¸å…³æ•°æ®ï¼ˆä»·æ ¼ã€æ•°é‡ã€ç›ˆäºç­‰ï¼‰
  imageUrls       String?  // JSONæ•°ç»„çš„å›¾ç‰‡URL
  isPublic        Boolean  @default(false) // æ˜¯å¦å…¬å¼€
  sentiment       String?  // å¸‚åœºæƒ…ç»ª: 'bullish', 'bearish', 'neutral'
  sortOrder       Int      @default(0) // æ’åºé¡ºåº
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relations
  user            User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  folder          JournalFolder? @relation(fields: [folderId], references: [id], onDelete: SetNull)
  
  @@index([walletAddress])
  @@index([userId])
  @@index([folderId])
  @@index([category])
  @@index([createdAt])
  @@map("journal_entries")
}